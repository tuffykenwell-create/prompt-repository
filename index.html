<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt Repository</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCd2dF67723Ejjea6Suznc3RBrqc0ELDMc",
            authDomain: "prompt-repository-b506c.firebaseapp.com",
            projectId: "prompt-repository-b506c",
            storageBucket: "prompt-repository-b506c.firebasestorage.app",
            messagingSenderId: "361363731451",
            appId: "1:361363731451:web:a6271f320bdab7a455d15e"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Simple icon components
        const PlusIcon = () => <span>➕</span>;
        const EditIcon = () => <span>✏️</span>;
        const TrashIcon = () => <span>🗑️</span>;
        const CopyIcon = () => <span>📋</span>;
        const ExternalLinkIcon = () => <span>🔗</span>;
        const XIcon = () => <span>✖️</span>;
        const ChevronDownIcon = () => <span>▼</span>;
        const ChevronUpIcon = () => <span>▲</span>;
        const HelpIcon = () => <span>❓</span>;
        const PaperclipIcon = () => <span>📎</span>;
        const DownloadIcon = () => <span>⬇️</span>;
        const UploadIcon = () => <span>📤</span>;

        const PromptRepository = () => {
            const [prompts, setPrompts] = useState([]);
            const [loading, setLoading] = useState(true);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [editingPrompt, setEditingPrompt] = useState(null);
            const [formData, setFormData] = useState({
                name: '',
                description: '',
                prompt: ''
            });
            const [selectedModel, setSelectedModel] = useState('claude');
            const [runningPromptId, setRunningPromptId] = useState(null);
            const [isModelModalOpen, setIsModelModalOpen] = useState(false);
            const [modelFormData, setModelFormData] = useState({ name: '', url: '' });
            
            const defaultModels = [
                { id: 'claude', name: 'Claude', url: 'https://claude.ai/new', isDefault: true },
                { id: 'chatgpt', name: 'ChatGPT', url: 'https://chat.openai.com/', isDefault: true },
                { id: 'gemini', name: 'Gemini', url: 'https://gemini.google.com/', isDefault: true },
                { id: 'copilot', name: 'Copilot', url: 'https://copilot.microsoft.com/', isDefault: true }
            ];

            const [customModels, setCustomModels] = useState([]);
            const aiModels = [...defaultModels, ...customModels];
            const [expandedPrompts, setExpandedPrompts] = useState({});
            const [isFaqOpen, setIsFaqOpen] = useState(false);
            const [showAccessModal, setShowAccessModal] = useState(false);
            const [pendingPrompt, setPendingPrompt] = useState(null);
            const [uploadingFiles, setUploadingFiles] = useState({});
            const [promptFiles, setPromptFiles] = useState({});

            // Load prompts from Firestore
            useEffect(() => {
                const unsubscribe = db.collection('prompts').onSnapshot((snapshot) => {
                    const promptsData = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    setPrompts(promptsData);
                    setLoading(false);
                    
                    // Load files for each prompt
                    promptsData.forEach(prompt => {
                        loadPromptFiles(prompt.id);
                    });
                }, (error) => {
                    console.error('Error loading prompts:', error);
                    alert('Error loading prompts: ' + error.message);
                    setLoading(false);
                });

                return () => unsubscribe();
            }, []);

            // Load custom models from Firestore
            useEffect(() => {
                const unsubscribe = db.collection('customModels').onSnapshot((snapshot) => {
                    const modelsData = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    setCustomModels(modelsData);
                });

                return () => unsubscribe();
            }, []);

            const loadPromptFiles = async (promptId) => {
                try {
                    const filesRef = storage.ref(`prompts/${promptId}`);
                    const result = await filesRef.listAll();
                    
                    const filesData = await Promise.all(
                        result.items.map(async (item) => {
                            const url = await item.getDownloadURL();
                            const metadata = await item.getMetadata();
                            return {
                                name: item.name,
                                url: url,
                                size: metadata.size,
                                contentType: metadata.contentType
                            };
                        })
                    );
                    
                    setPromptFiles(prev => ({
                        ...prev,
                        [promptId]: filesData
                    }));
                } catch (error) {
                    console.error('Error loading files:', error);
                }
            };

            const handleFileUpload = async (promptId, files) => {
                const fileArray = Array.from(files);
                
                // Check file sizes
                const oversizedFiles = fileArray.filter(f => f.size > 10 * 1024 * 1024);
                if (oversizedFiles.length > 0) {
                    alert(`The following files are too large (max 10 MB):\n${oversizedFiles.map(f => f.name).join('\n')}`);
                    return;
                }
                
                setUploadingFiles(prev => ({ ...prev, [promptId]: true }));
                
                try {
                    await Promise.all(
                        fileArray.map(async (file) => {
                            const storageRef = storage.ref(`prompts/${promptId}/${file.name}`);
                            await storageRef.put(file);
                        })
                    );
                    
                    await loadPromptFiles(promptId);
                    alert(`${fileArray.length} file(s) uploaded successfully!`);
                } catch (error) {
                    console.error('Error uploading files:', error);
                    alert('Error uploading files: ' + error.message);
                } finally {
                    setUploadingFiles(prev => ({ ...prev, [promptId]: false }));
                }
            };

            const deleteFile = async (promptId, fileName) => {
                if (confirm(`Delete ${fileName}?`)) {
                    try {
                        const storageRef = storage.ref(`prompts/${promptId}/${fileName}`);
                        await storageRef.delete();
                        await loadPromptFiles(promptId);
                    } catch (error) {
                        console.error('Error deleting file:', error);
                        alert('Error deleting file: ' + error.message);
                    }
                }
            };

            const formatFileSize = (bytes) => {
                if (bytes < 1024) return bytes + ' B';
                if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
                return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
            };

            const openModal = (prompt = null) => {
                if (prompt) {
                    setEditingPrompt(prompt);
                    setFormData({
                        name: prompt.name,
                        description: prompt.description,
                        prompt: prompt.prompt
                    });
                } else {
                    setEditingPrompt(null);
                    setFormData({ name: '', description: '', prompt: '' });
                }
                setIsModalOpen(true);
            };

            const closeModal = () => {
                setIsModalOpen(false);
                setEditingPrompt(null);
                setFormData({ name: '', description: '', prompt: '' });
            };

            const handleSave = async () => {
                const trimmedName = formData.name?.trim() || '';
                const trimmedDescription = formData.description?.trim() || '';
                const trimmedPrompt = formData.prompt?.trim() || '';
                
                if (!trimmedName) {
                    alert('Please enter a prompt name');
                    return;
                }
                if (!trimmedDescription) {
                    alert('Please enter a short description');
                    return;
                }
                if (!trimmedPrompt) {
                    alert('Please enter the prompt text');
                    return;
                }
                
                const cleanedData = {
                    name: trimmedName,
                    description: trimmedDescription,
                    prompt: trimmedPrompt
                };
                
                try {
                    if (editingPrompt) {
                        await db.collection('prompts').doc(editingPrompt.id).update({
                            ...cleanedData,
                            version: editingPrompt.version + 1,
                            updatedAt: new Date().toISOString()
                        });
                    } else {
                        await db.collection('prompts').add({
                            ...cleanedData,
                            version: 1,
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        });
                    }
                    closeModal();
                } catch (error) {
                    console.error('Error saving prompt:', error);
                    alert('Error saving prompt: ' + error.message);
                }
            };

            const deletePrompt = async (id) => {
                if (confirm('Are you sure you want to delete this prompt? This will also delete all attached files.')) {
                    try {
                        // Delete all files first
                        const filesRef = storage.ref(`prompts/${id}`);
                        const result = await filesRef.listAll();
                        await Promise.all(result.items.map(item => item.delete()));
                        
                        // Then delete the prompt
                        await db.collection('prompts').doc(id).delete();
                    } catch (error) {
                        console.error('Error deleting prompt:', error);
                        alert('Error deleting prompt: ' + error.message);
                    }
                }
            };

            const copyToClipboard = async (text) => {
                try {
                    await navigator.clipboard.writeText(text);
                    alert('Prompt copied to clipboard!');
                } catch (err) {
                    alert('Failed to copy to clipboard');
                }
            };

            const runPrompt = (prompt) => {
                setPendingPrompt(prompt);
                setShowAccessModal(true);
            };

            const executePromptOpen = (useIncognito) => {
                if (!pendingPrompt) return;
                
                setRunningPromptId(pendingPrompt.id);
                copyToClipboard(pendingPrompt.prompt);
                
                const model = aiModels.find(m => m.id === selectedModel);
                
                const files = promptFiles[pendingPrompt.id] || [];
                const fileMessage = files.length > 0 
                    ? `\n\nAttached files (${files.length}):\n${files.map(f => `• ${f.name} (${formatFileSize(f.size)})`).join('\n')}\n\nDownload these files first, then upload them to the AI along with your prompt!`
                    : '';
                
                if (useIncognito) {
                    alert('Opening in a new tab. To use incognito/private mode:\n\n' +
                        '• Desktop: Right-click the link and select "Open in Incognito/Private Window"\n' +
                        '• Mobile: Long-press the tab switcher and select "New Incognito Tab", then paste the URL\n\n' +
                        'Your prompt has been copied - paste it when ready!' + fileMessage);
                } else if (files.length > 0) {
                    alert('Your prompt has been copied!' + fileMessage);
                }
                
                setTimeout(() => {
                    window.open(model.url, '_blank');
                    setRunningPromptId(null);
                    setShowAccessModal(false);
                    setPendingPrompt(null);
                }, 500);
            };

            const formatDate = (dateString) => {
                return new Date(dateString).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            };

            const openModelModal = () => {
                setModelFormData({ name: '', url: '' });
                setIsModelModalOpen(true);
            };

            const closeModelModal = () => {
                setIsModelModalOpen(false);
                setModelFormData({ name: '', url: '' });
            };

            const handleAddModel = async () => {
                if (!modelFormData.name || !modelFormData.url) {
                    alert('Please fill in both model name and URL');
                    return;
                }

                try {
                    await db.collection('customModels').add({
                        name: modelFormData.name,
                        url: modelFormData.url,
                        isDefault: false
                    });
                    closeModelModal();
                } catch (error) {
                    console.error('Error adding model:', error);
                    alert('Error adding model: ' + error.message);
                }
            };

            const deleteModel = async (id) => {
                if (confirm('Are you sure you want to delete this AI model?')) {
                    try {
                        await db.collection('customModels').doc(id).delete();
                        if (selectedModel === id) {
                            setSelectedModel('claude');
                        }
                    } catch (error) {
                        console.error('Error deleting model:', error);
                        alert('Error deleting model: ' + error.message);
                    }
                }
            };

            const togglePromptExpanded = (id) => {
                setExpandedPrompts(prev => ({
                    ...prev,
                    [id]: !prev[id]
                }));
            };

            if (loading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center">
                        <div className="text-xl text-gray-700">Loading your prompts...</div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-3 md:p-6">
                    <div className="max-w-6xl mx-auto">
                        <div className="bg-white rounded-lg shadow-lg p-4 md:p-8 mb-4 md:mb-6">
                            <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
                                <div className="flex-1">
                                    <h1 className="text-2xl md:text-3xl font-bold text-gray-800 mb-2">Prompt Repository</h1>
                                    <p className="text-sm md:text-base text-gray-600">Manage and version your custom AI prompts</p>
                                </div>
                                <div className="flex gap-2 w-full sm:w-auto">
                                    <button
                                        onClick={() => setIsFaqOpen(true)}
                                        className="flex-1 sm:flex-initial bg-gray-600 hover:bg-gray-700 text-white px-4 py-3 md:py-2 rounded-lg flex items-center justify-center gap-2 transition-colors touch-manipulation font-medium"
                                    >
                                        <HelpIcon />
                                        <span className="sm:inline">Help</span>
                                    </button>
                                    <button
                                        onClick={() => openModal()}
                                        className="flex-1 sm:flex-initial bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-3 md:py-2 rounded-lg flex items-center justify-center gap-2 transition-colors touch-manipulation font-medium"
                                    >
                                        <PlusIcon />
                                        New Prompt
                                    </button>
                                </div>
                            </div>

                            <div className="mb-6 p-3 md:p-4 bg-gray-50 rounded-lg border border-gray-200">
                                <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 mb-3">
                                    <h3 className="text-base md:text-lg font-semibold text-gray-800">AI Models</h3>
                                    <button
                                        onClick={openModelModal}
                                        className="w-full sm:w-auto bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded text-sm font-medium flex items-center justify-center gap-2 transition-colors touch-manipulation"
                                    >
                                        <PlusIcon />
                                        Add Model
                                    </button>
                                </div>
                                <div className="flex flex-wrap gap-2">
                                    {aiModels.map(model => (
                                        <div key={model.id} className="bg-white px-3 py-2 rounded border border-gray-300 flex items-center gap-2">
                                            <span className="text-sm font-medium text-gray-700">{model.name}</span>
                                            {!model.isDefault && (
                                                <button
                                                    onClick={() => deleteModel(model.id)}
                                                    className="text-red-500 hover:text-red-700 touch-manipulation p-1"
                                                    title="Delete model"
                                                >
                                                    <XIcon />
                                                </button>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <div className="grid gap-4">
                                {prompts.sort((a, b) => a.name.localeCompare(b.name)).map(prompt => {
                                    const isExpanded = expandedPrompts[prompt.id];
                                    const files = promptFiles[prompt.id] || [];
                                    const isUploading = uploadingFiles[prompt.id];
                                    
                                    return (
                                        <div key={prompt.id} className="border border-gray-200 rounded-lg p-4 md:p-6 hover:shadow-md transition-shadow">
                                            <div className="flex justify-between items-start mb-3">
                                                <div className="flex-1 min-w-0 pr-2">
                                                    <div className="flex items-center gap-2 mb-2 flex-wrap">
                                                        <h3 className="text-lg md:text-xl font-semibold text-gray-800 break-words">{prompt.name}</h3>
                                                        <span className="bg-indigo-100 text-indigo-800 text-xs px-2 py-1 rounded whitespace-nowrap">
                                                            v{prompt.version}
                                                        </span>
                                                        {files.length > 0 && (
                                                            <span className="bg-green-100 text-green-800 text-xs px-2 py-1 rounded whitespace-nowrap flex items-center gap-1">
                                                                <PaperclipIcon /> {files.length}
                                                            </span>
                                                        )}
                                                    </div>
                                                    <p className="text-sm md:text-base text-gray-600 mb-2 break-words">{prompt.description}</p>
                                                    <div className="text-xs md:text-sm text-gray-500">
                                                        <span>Updated: {formatDate(prompt.updatedAt)}</span>
                                                    </div>
                                                </div>
                                                
                                                <div className="flex gap-1 md:gap-2 flex-shrink-0">
                                                    <button
                                                        onClick={() => copyToClipboard(prompt.prompt)}
                                                        className="p-2 text-gray-600 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors touch-manipulation"
                                                        title="Copy prompt"
                                                    >
                                                        <CopyIcon />
                                                    </button>
                                                    <button
                                                        onClick={() => openModal(prompt)}
                                                        className="p-2 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors touch-manipulation"
                                                        title="Edit prompt"
                                                    >
                                                        <EditIcon />
                                                    </button>
                                                    <button
                                                        onClick={() => deletePrompt(prompt.id)}
                                                        className="p-2 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded transition-colors touch-manipulation"
                                                        title="Delete prompt"
                                                    >
                                                        <TrashIcon />
                                                    </button>
                                                </div>
                                            </div>

                                            {/* File Upload Section */}
                                            <div className="mb-4 p-3 bg-gray-50 rounded border border-gray-200">
                                                <div className="flex items-center justify-between mb-2">
                                                    <label className="text-sm font-medium text-gray-700 flex items-center gap-2">
                                                        <PaperclipIcon /> Attached Documents
                                                    </label>
                                                    <label className="cursor-pointer bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs font-medium flex items-center gap-1 transition-colors">
                                                        <UploadIcon /> Upload
                                                        <input
                                                            type="file"
                                                            multiple
                                                            onChange={(e) => handleFileUpload(prompt.id, e.target.files)}
                                                            className="hidden"
                                                            disabled={isUploading}
                                                        />
                                                    </label>
                                                </div>
                                                
                                                {isUploading && (
                                                    <div className="text-sm text-blue-600 mb-2">Uploading files...</div>
                                                )}
                                                
                                                {files.length > 0 ? (
                                                    <div className="space-y-1">
                                                        {files.map((file, idx) => (
                                                            <div key={idx} className="flex items-center justify-between bg-white p-2 rounded text-sm">
                                                                <span className="flex-1 truncate text-gray-700">{file.name}</span>
                                                                <span className="text-xs text-gray-500 mx-2">{formatFileSize(file.size)}</span>
                                                                <div className="flex gap-1">
                                                                    <a
                                                                        href={file.url}
                                                                        download={file.name}
                                                                        className="p-1 text-green-600 hover:text-green-700"
                                                                        title="Download"
                                                                    >
                                                                        <DownloadIcon />
                                                                    </a>
                                                                    <button
                                                                        onClick={() => deleteFile(prompt.id, file.name)}
                                                                        className="p-1 text-red-500 hover:text-red-700"
                                                                        title="Delete"
                                                                    >
                                                                        <TrashIcon />
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                ) : (
                                                    <div className="text-sm text-gray-500 text-center py-2">
                                                        No files attached. Upload documents to reference with this prompt.
                                                    </div>
                                                )}
                                            </div>

                                            <button
                                                onClick={() => togglePromptExpanded(prompt.id)}
                                                className="w-full bg-gray-50 rounded p-3 mb-4 border border-gray-200 text-left flex justify-between items-center touch-manipulation hover:bg-gray-100 transition-colors"
                                            >
                                                <span className="text-sm font-medium text-gray-700">
                                                    {isExpanded ? 'Hide Prompt' : 'Show Prompt'}
                                                </span>
                                                {isExpanded ? <ChevronUpIcon /> : <ChevronDownIcon />}
                                            </button>

                                            {isExpanded && (
                                                <div className="bg-gray-50 rounded p-3 md:p-4 mb-4 border border-gray-200 max-h-64 overflow-y-auto">
                                                    <pre className="text-xs md:text-sm text-gray-700 whitespace-pre-wrap font-mono break-words">
                                                        {prompt.prompt}
                                                    </pre>
                                                </div>
                                            )}

                                            <div className="flex flex-col sm:flex-row items-stretch sm:items-center gap-3">
                                                <label className="text-sm font-medium text-gray-700 sm:whitespace-nowrap">Run with:</label>
                                                <select
                                                    value={selectedModel}
                                                    onChange={(e) => setSelectedModel(e.target.value)}
                                                    className="flex-1 sm:flex-initial border border-gray-300 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 touch-manipulation"
                                                >
                                                    {aiModels.map(model => (
                                                        <option key={model.id} value={model.id}>{model.name}</option>
                                                    ))}
                                                </select>
                                                <button
                                                    onClick={() => runPrompt(prompt)}
                                                    disabled={runningPromptId === prompt.id}
                                                    className="w-full sm:w-auto bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-4 py-2 rounded text-sm font-medium flex items-center justify-center gap-2 transition-colors touch-manipulation"
                                                >
                                                    <ExternalLinkIcon />
                                                    {runningPromptId === prompt.id ? 'Opening...' : 'Open AI'}
                                                </button>
                                            </div>
                                        </div>
                                    );
                                })}

                                {prompts.length === 0 && (
                                    <div className="text-center py-12 text-gray-500">
                                        <p className="text-lg mb-2">No prompts yet</p>
                                        <p>Click "New Prompt" to create your first prompt</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    {isModalOpen && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-3 md:p-4 z-50">
                            <div className="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                                <div className="flex justify-between items-center p-4 md:p-6 border-b sticky top-0 bg-white z-10">
                                    <h2 className="text-xl md:text-2xl font-bold text-gray-800">
                                        {editingPrompt ? 'Edit Prompt' : 'New Prompt'}
                                    </h2>
                                    <button
                                        onClick={closeModal}
                                        className="text-gray-400 hover:text-gray-600 transition-colors p-2 touch-manipulation"
                                    >
                                        <XIcon />
                                    </button>
                                </div>

                                <div className="p-4 md:p-6">
                                    <div className="mb-4">
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Prompt Name *
                                        </label>
                                        <input
                                            type="text"
                                            value={formData.name}
                                            onChange={(e) => setFormData({...formData, name: e.target.value})}
                                            className="w-full border border-gray-300 rounded-lg px-4 py-3 md:py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 text-base"
                                            placeholder="e.g., Code Reviewer"
                                        />
                                    </div>

                                    <div className="mb-4">
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Short Description *
                                        </label>
                                        <input
                                            type="text"
                                            value={formData.description}
                                            onChange={(e) => setFormData({...formData, description: e.target.value})}
                                            className="w-full border border-gray-300 rounded-lg px-4 py-3 md:py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 text-base"
                                            placeholder="Brief description of what this prompt does"
                                        />
                                    </div>

                                    <div className="mb-6">
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Prompt Text *
                                        </label>
                                        <textarea
                                            value={formData.prompt}
                                            onChange={(e) => setFormData({...formData, prompt: e.target.value})}
                                            rows={10}
                                            className="w-full border border-gray-300 rounded-lg px-4 py-3 md:py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 font-mono text-sm"
                                            placeholder="Enter your prompt here..."
                                        />
                                    </div>

                                    {editingPrompt && (
                                        <div className="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                                            <p className="text-sm text-blue-800">
                                                Updating this prompt will increment its version from v{editingPrompt.version} to v{editingPrompt.version + 1}
                                            </p>
                                        </div>
                                    )}

                                    <div className="flex flex-col sm:flex-row gap-3 justify-end">
                                        <button
                                            onClick={closeModal}
                                            className="w-full sm:w-auto px-6 py-3 md:py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors touch-manipulation font-medium"
                                        >
                                            Cancel
                                        </button>
                                        <button
                                            onClick={handleSave}
                                            className="w-full sm:w-auto px-6 py-3 md:py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors touch-manipulation font-medium"
                                        >
                                            {editingPrompt ? 'Update Prompt' : 'Create Prompt'}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {isModelModalOpen && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-3 md:p-4 z-50">
                            <div className="bg-white rounded-lg shadow-xl max-w-md w-full">
                                <div className="flex justify-between items-center p-4 md:p-6 border-b">
                                    <h2 className="text-xl md:text-2xl font-bold text-gray-800">Add AI Model</h2>
                                    <button
                                        onClick={closeModelModal}
                                        className="text-gray-400 hover:text-gray-600 transition-colors p-2 touch-manipulation"
                                    >
                                        <XIcon />
                                    </button>
                                </div>

                                <div className="p-4 md:p-6">
                                    <div className="mb-4">
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Model Name *
                                        </label>
                                        <input
                                            type="text"
                                            value={modelFormData.name}
                                            onChange={(e) => setModelFormData({...modelFormData, name: e.target.value})}
                                            className="w-full border border-gray-300 rounded-lg px-4 py-3 md:py-2 focus:outline-none focus:ring-2 focus:ring-green-500 text-base"
                                            placeholder="e.g., Perplexity"
                                        />
                                    </div>

                                    <div className="mb-6">
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            URL *
                                        </label>
                                        <input
                                            type="url"
                                            value={modelFormData.url}
                                            onChange={(e) => setModelFormData({...modelFormData, url: e.target.value})}
                                            className="w-full border border-gray-300 rounded-lg px-4 py-3 md:py-2 focus:outline-none focus:ring-2 focus:ring-green-500 text-base"
                                            placeholder="https://www.perplexity.ai/"
                                        />
                                        <p className="text-xs text-gray-500 mt-1">Enter the URL where the AI chat interface is located</p>
                                    </div>

                                    <div className="flex flex-col sm:flex-row gap-3 justify-end">
                                        <button
                                            onClick={closeModelModal}
                                            className="w-full sm:w-auto px-6 py-3 md:py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors touch-manipulation font-medium"
                                        >
                                            Cancel
                                        </button>
                                        <button
                                            onClick={handleAddModel}
                                            className="w-full sm:w-auto px-6 py-3 md:py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors touch-manipulation font-medium"
                                        >
                                            Add Model
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {isFaqOpen && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-3 md:p-4 z-50 overflow-y-auto">
                            <div className="bg-white rounded-lg shadow-xl max-w-3xl w-full my-8 max-h-[90vh] overflow-y-auto">
                                <div className="flex justify-between items-center p-4 md:p-6 border-b sticky top-0 bg-white z-10">
                                    <h2 className="text-xl md:text-2xl font-bold text-gray-800">How to Use</h2>
                                    <button
                                        onClick={() => setIsFaqOpen(false)}
                                        className="text-gray-400 hover:text-gray-600 transition-colors p-2 touch-manipulation"
                                    >
                                        <XIcon />
                                    </button>
                                </div>
                                <div className="p-4 md:p-6 space-y-4">
                                    <div>
                                        <h3 className="font-semibold text-lg mb-2">✨ Your prompts are saved in the cloud!</h3>
                                        <p className="text-gray-700">All changes sync automatically across your devices.</p>
                                    </div>
                                    <div>
                                        <h3 className="font-semibold mb-2">📎 Attaching Documents</h3>
                                        <p className="text-gray-700 mb-2">You can now upload reference documents (Word, PDF, etc.) to any prompt:</p>
                                        <ul className="list-disc ml-6 text-gray-700 space-y-1">
                                            <li>Click the "Upload" button in the "Attached Documents" section</li>
                                            <li>Select one or multiple files (max 10 MB each)</li>
                                            <li>Files are saved with your prompt in the cloud</li>
                                            <li>Download files when you need them by clicking the download icon</li>
                                            <li>When you run a prompt with files, you'll be reminded to download and upload them to the AI</li>
                                        </ul>
                                    </div>
                                    <div>
                                        <h3 className="font-semibold mb-2">Creating Prompts</h3>
                                        <p className="text-gray-700">Click "New Prompt" and fill in the name, description, and prompt text.</p>
                                    </div>
                                    <div>
                                        <h3 className="font-semibold mb-2">Using Prompts</h3>
                                        <p className="text-gray-700">Select an AI model, click "Open AI", choose login or guest mode, then paste the prompt when the AI opens. If files are attached, download them first and upload to the AI along with your prompt.</p>
                                    </div>
                                    <div>
                                        <h3 className="font-semibold mb-2">Editing</h3>
                                        <p className="text-gray-700">Click the ✏️ icon to edit. The version number automatically increments with each update.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {showAccessModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-3 md:p-4 z-50">
                            <div className="bg-white rounded-lg shadow-xl max-w-md w-full">
                                <div className="p-4 md:p-6 border-b">
                                    <h2 className="text-xl md:text-2xl font-bold text-gray-800">Choose Access Mode</h2>
                                    <p className="text-sm text-gray-600 mt-2">How would you like to open {aiModels.find(m => m.id === selectedModel)?.name}?</p>
                                </div>

                                <div className="p-4 md:p-6 space-y-3">
                                    <button
                                        onClick={() => executePromptOpen(false)}
                                        className="w-full bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-lg text-left transition-colors touch-manipulation"
                                    >
                                        <div className="flex items-start gap-3">
                                            <div className="text-2xl">🔐</div>
                                            <div className="flex-1">
                                                <p className="font-semibold mb-1">Login Mode (Recommended)</p>
                                                <p className="text-sm text-blue-100">Save conversation to your account. Results will be available in your history.</p>
                                            </div>
                                        </div>
                                    </button>

                                    <button
                                        onClick={() => executePromptOpen(true)}
                                        className="w-full bg-purple-600 hover:bg-purple-700 text-white p-4 rounded-lg text-left transition-colors touch-manipulation"
                                    >
                                        <div className="flex items-start gap-3">
                                            <div className="text-2xl">👤</div>
                                            <div className="flex-1">
                                                <p className="font-semibold mb-1">Guest/Private Mode</p>
                                                <p className="text-sm text-purple-100">One-time use. Conversation won't be saved.</p>
                                            </div>
                                        </div>
                                    </button>

                                    <button
                                        onClick={() => {
                                            setShowAccessModal(false);
                                            setPendingPrompt(null);
                                        }}
                                        className="w-full border-2 border-gray-300 hover:bg-gray-50 text-gray-700 p-3 rounded-lg transition-colors touch-manipulation font-medium"
                                    >
                                        Cancel
                                    </button>
                                </div>

                                <div className="p-4 bg-gray-50 border-t">
                                    <p className="text-xs text-gray-600 text-center">Your prompt has been copied to clipboard!</p>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<PromptRepository />, document.getElementById('root'));
    </script>
</body>
</html>
